<!doctype html>
<html lang="de">
  <head>
    <title>Simulation</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css"/>
</head>
  <body>
    <div id="parameter"></div>
    <div id="sim"></div>
    <script>
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            myFunction(this);
        }
    };
    xhttp.open("GET", "/simulation/fmu/modelDescription.xml", true);
    xhttp.send();

    function myFunction(xml) {
      var x, xmlDoc;
      var txt = "<table id='variationParameter'>";
      xmlDoc = xml.responseXML;
      x = xmlDoc.getElementsByTagName("ScalarVariable");
      for (i=0;i<x.length;i++)
      {
        var name = x[i].attributes.getNamedItem("name").nodeValue;
        var valueReference = x[i].attributes.getNamedItem("valueReference").nodeValue;
        var causality = x[i].attributes.getNamedItem("causality").nodeValue;
        if (causality=="parameter")
        {
          var value = x[i].childNodes[1].attributes[0].nodeValue;
          txt+="<tr>";
          txt+="<td><label for='" + name + "'>" + name + "</label></td>";
          txt+="<td><input id='param" + i + "' type='text' name='" + name + "" + "' valueReference='" + valueReference + "' value='" + value + "'/></td>";
          txt+="</tr>";
        }
      }
      txt+="</table>";
      txt+="<button type='button' onclick='simulate()'>Simulate</button>";
      document.getElementById("parameter").innerHTML = txt;
    }
    function simulate()
    {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("sim").innerHTML = this.responseText;
        }
      };

      var parameterlist = "";
      var variationParameter = document.getElementById("variationParameter");
      var parameter = variationParameter.getElementsByTagName("input");

      for (i=0;i<parameter.length;i++)
      {
        if(i>0) parameterlist+="&";
        parameterlist+="pref"+i+"=";
        parameterlist+=parameter[i].getAttribute("valueReference");
        parameterlist+="&";
        parameterlist+="pval"+i+"=";
        parameterlist+=parameter[i].value;
      }

      xhttp.open("POST", "sim.php", true);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhttp.send(parameterlist);
    }
    </script>
  </body>

</html>
